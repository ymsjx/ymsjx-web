<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>饭卡系统流程模拟（演示版）</title>
  <style>
    body {
      font-family: Consolas, monospace;
      background: #ffffff;
      color: #222;
      padding: 20px;
    }
    h2 {
      color: #0066cc;
    }
    input, button {
      background: #f7f7f7;
      color: #222;
      border: 1px solid #aaa;
      padding: 8px;
      margin-top: 8px;
      width: 300px;
      font-family: Consolas, monospace;
    }
    button {
      cursor: pointer;
      width: 320px;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    #log {
      background: #fafafa;
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 15px;
      height: 260px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    .hidden {
      display: none;
    }
    .progress {
      margin-top: 10px;
      background: #eee;
      border: 1px solid #aaa;
      width: 320px;
      height: 20px;
    }
    .bar {
      height: 100%;
      width: 0%;
      background: #4caf50;
      transition: width 0.1s linear;
    }
  </style>
</head>

<body>
  <h2>饭卡系统流程模拟（演示版）</h2>

  <div>
    <input id="card" placeholder="请输入卡号（字母或数字）" />
  </div>

  <div id="balanceBox" class="hidden">
    <input id="balance" placeholder="请输入要修改的余额（元）" />
  </div>

  <button id="btn">开始 / 继续</button>

  <div class="progress hidden" id="progressBox">
    <div class="bar" id="progressBar"></div>
  </div>

  <div id="log"></div>

<script>
let stage = 0;
const logBox = document.getElementById("log");
const btn = document.getElementById("btn");
const progressBox = document.getElementById("progressBox");
const progressBar = document.getElementById("progressBar");
const balanceBox = document.getElementById("balanceBox");

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

function log(text) {
  logBox.textContent += text + "\n";
  logBox.scrollTop = logBox.scrollHeight;
}

async function runProgress(speed = 40, hooks = {}) {
  progressBox.classList.remove("hidden");
  progressBar.style.width = "0%";

  for (let i = 0; i <= 100; i++) {
    progressBar.style.width = i + "%";

    if (hooks[i]) {
      log(hooks[i]);
    }

    await sleep(speed);
  }

  progressBox.classList.add("hidden");
}

btn.onclick = async () => {
  btn.disabled = true;

  if (stage === 0) {
    const card = document.getElementById("card").value.trim();

    // ✅ 允许字母 + 数字
    if (!card || !/^[a-zA-Z0-9]+$/.test(card)) {
      alert("请输入正确的卡号（字母或数字）");
      btn.disabled = false;
      return;
    }

    log("欢迎使用饭卡修改余额程序");
    await sleep(800);

    log("正在校验卡号：" + card);
    await sleep(1000);

    log("正在连接饭卡管理后台……");
    await sleep(1000);

    await runProgress(35);

    log("连接成功 ✔");
    log("请输入要修改的余额后，点击按钮继续");

    balanceBox.classList.remove("hidden");
    stage = 1;
  }

  else if (stage === 1) {
    const balance = document.getElementById("balance").value.trim();
    if (!balance) {
      alert("请输入要修改的余额");
      btn.disabled = false;
      return;
    }

    log("开始模拟破解流程");

    await runProgress(50, {
      30: "已绕过基础校验……",
      60: "正在写入新余额……",
      85: "正在同步账务系统……"
    });

    log("———— 修改完成 ————");
    log("（演示）余额显示为：" + balance + " 元");

    stage = 2;
  }

  else {
    alert("流程已完成，请刷新页面重新开始");
  }

  btn.disabled = false;
};
</script>
</body>
</html>