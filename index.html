<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>饭卡余额篡改系统</title>
<style>
body { font-family: Consolas, monospace; background: #ffffff; color: #222; padding: 20px; }
h2 { color: #0066cc; }
input, button { background: #f7f7f7; color: #222; border: 1px solid #aaa; padding: 8px; margin-top: 8px; width: 300px; font-family: Consolas, monospace; }
button { cursor: pointer; width: 320px; }
button:disabled { opacity:0.5; cursor:not-allowed; }
#log { background:#fafafa; border:1px solid #ccc; padding:10px; margin-top:15px; height:260px; overflow-y:auto; white-space:pre-wrap;}
.hidden { display:none; }
.progress { margin-top:10px; background:#eee; border:1px solid #aaa; width:320px; height:20px;}
.bar { height:100%; width:0%; background:#4caf50; transition: width 0.1s linear; }
.small-btn { width:150px; margin-right:10px; }
</style>
</head>
<body>
<h2>欢迎使用饭卡余额篡改系统（仅供娱乐）</h2>
<h5>首次使用请先注册账号</h5>

<!-- 登录/注册 -->
<div id="authBox">
  <div id="loginForm">
    <div><input id="loginUsername" placeholder="用户名"></div>
    <div><input id="loginPassword" type="password" placeholder="密码"></div>
    <button id="loginBtn">登录</button>
    <button class="small-btn" id="showRegisterBtn">注册</button>
  </div>
  <div id="registerForm" class="hidden">
    <div><input id="regUsername" placeholder="用户名"></div>
    <div><input id="regPassword" type="password" placeholder="密码"></div>
    <button id="registerBtn">注册</button>
    <button class="small-btn" id="showLoginBtn">返回登录</button>
  </div>
</div>

<!-- 饭卡流程 -->
<div id="mainBox" class="hidden">
  <div><input id="card" placeholder="请输入卡号（字母或数字）"></div>
  <div id="balanceBox" class="hidden"><input id="balance" placeholder="请输入要修改的余额（元）"></div>
  <div class="progress hidden" id="progressBox"><div class="bar" id="progressBar"></div></div>
  <div id="log"></div>
</div>

<script>
let stage=0;
const logBox=document.getElementById("log");
const btn=document.createElement("button"); btn.textContent="开始 / 继续"; btn.style.width="320px";
document.getElementById("mainBox").appendChild(btn);
const progressBox=document.getElementById("progressBox");
const progressBar=document.getElementById("progressBar");
const balanceBox=document.getElementById("balanceBox");

function sleep(ms){return new Promise(resolve=>setTimeout(resolve,ms))}
function log(text){logBox.textContent+=text+"\n"; logBox.scrollTop=logBox.scrollHeight;}

async function runProgress(speed=40,hooks={}) {
  progressBox.classList.remove("hidden");
  progressBar.style.width="0%";
  for(let i=0;i<=100;i++){
    progressBar.style.width=i+"%";
    if(hooks[i]) log(hooks[i]);
    await sleep(speed);
  }
  progressBox.classList.add("hidden");
}

// ---------------- 登录/注册逻辑 ----------------
const loginBtnEl=document.getElementById("loginBtn");
const showRegisterBtn=document.getElementById("showRegisterBtn");
const showLoginBtn=document.getElementById("showLoginBtn");
const registerBtn=document.getElementById("registerBtn");
const loginForm=document.getElementById("loginForm");
const registerForm=document.getElementById("registerForm");
const authBox=document.getElementById("authBox");
const mainBox=document.getElementById("mainBox");

showRegisterBtn.onclick=()=>{ loginForm.classList.add("hidden"); registerForm.classList.remove("hidden"); }
showLoginBtn.onclick=()=>{ registerForm.classList.add("hidden"); loginForm.classList.remove("hidden"); }

registerBtn.onclick=()=>{
  const username=document.getElementById("regUsername").value.trim();
  const password=document.getElementById("regPassword").value.trim();
  if(!username||!password){ alert("用户名和密码不能为空"); return; }
  const users=JSON.parse(localStorage.getItem("users")||"{}");
  if(users[username]){ alert("用户名已存在"); return; }
  users[username]=password;
  localStorage.setItem("users",JSON.stringify(users));
  alert("注册成功！请登录");
  registerForm.classList.add("hidden"); loginForm.classList.remove("hidden");
  document.getElementById("loginUsername").value=username;
}

loginBtnEl.onclick=()=>{
  const username=document.getElementById("loginUsername").value.trim();
  const password=document.getElementById("loginPassword").value.trim();
  const users=JSON.parse(localStorage.getItem("users")||"{}");
  if(users[username] && users[username]===password){
    alert("登录成功！");
    localStorage.setItem("savedUsername",username);
    authBox.classList.add("hidden");
    mainBox.classList.remove("hidden");
  } else {
    alert("用户名或密码错误");
  }
}

// ---------------- 饭卡流程逻辑 ----------------
btn.onclick=async ()=>{
  btn.disabled=true;
  const cardInput=document.getElementById("card");
  const balanceInput=document.getElementById("balance");

  if(stage===0){
    const card=cardInput.value.trim();
    if(!card || !/^[a-zA-Z0-9]+$/.test(card)){
      alert("请输入正确的卡号");
      btn.disabled=false;
      return;
    }
    log("欢迎使用饭卡余额篡改系统");
    await sleep(800);
    log("正在校验卡号："+card);
    await sleep(1000);
    log("正在连接饭卡管理后台……");
    await sleep(1000);
    await runProgress(35);
    log("连接成功");
    log("请输入想修改的余额（RMB）");
    balanceBox.classList.remove("hidden");
    stage=1;
  } else if(stage===1){
    const balance=balanceInput.value.trim();
    if(!balance || isNaN(balance)){
      alert("余额必须是正确的数字");
      btn.disabled=false;
      return;
    }
    log("启动强力篡改程序");
    await runProgress(50,{30:"已攻破建设银行防火墙……",60:"正在篡改底层数据……",85:"正在同步学校账务系统……"});
    log("———— 篡改结束 ————");
    log("余额已修改为："+balance+" 元");
    stage=2;
  } else {
    alert("流程已完成，请刷新页面重新开始");
  }
  btn.disabled=false;
}
</script>
</body>
</html>
